#!/usr/bin/env bash
set -euo pipefail

# update code from repo + restart service
cd /opt/clawgate
git fetch --all --prune
git reset --hard origin/main
git clean -fd

# venv deps optional (nur wenn requirements / pyproject changed)
if [ -f venv/bin/pip ]; then
  venv/bin/pip install -U pip >/dev/null
  if [ -f requirements.txt ]; then
    venv/bin/pip install -r requirements.txt
  fi
fi

sudo systemctl restart clawgate.service
./scripts/clawgate-health
